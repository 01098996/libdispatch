<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>libdispatch for Linux by nickhutchinson</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>libdispatch for Linux</h1>
        <h2>Linux port of Apple&#39;s open-source concurrency library</h2>
        <a href="https://github.com/nickhutchinson/libdispatch" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="libdispatch-for-linux" class="anchor" href="#libdispatch-for-linux" aria-hidden="true"><span class="octicon octicon-link"></span></a>libdispatch for Linux</h1>

<p>pthreads getting you down? <a href="http://libdispatch.macosforge.org">libdispatch</a>,
aka Grand Central Dispatch (GCD) is Apple's high-performance event-handling
library, introduced in OS X Snow Leopard. It provides asynchronous task queues,
monitoring of file descriptor read and write-ability, asynchronous I/O (for
sockets <em>and</em> regular files), readers-writer locks, parallel for-loops, sane
signal handling, periodic timers, semaphores and more. You'll want to read over
Apple's <a href="http://developer.apple.com/library/ios/#documentation/Performance/Reference/GCD_libdispatch_Ref/Reference/reference.html">API reference</a>.</p>

<h3>
<a id="changes-from-apples-official-version" class="anchor" href="#changes-from-apples-official-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes from Apple's official version</h3>

<p>I've added the ability to integrate libdispatch's main queue with third-party
run-loops, e.g. GLib's <code>GMainLoop</code>.  Call
<code>dispatch_get_main_queue_handle_np()</code> to get a file descriptor your run-loop
can monitor for reading; when it becomes readable call
<code>dispatch_main_queue_drain_np()</code> to execute the pending tasks.</p>

<p>I've also added missing <code>_f</code> variants for several functions in <code>data.h</code> and
<code>io.h</code> that took <a href="http://developer.apple.com/library/ios/#documentation/cocoa/Conceptual/Blocks/Articles/00_Introduction.html">Objective-C blocks</a>
only: look for the functions with <code>_np</code> appended to them. Although you can make
full use of libdispatch with compilers like GCC that don't support blocks, it
is not advisable to build libdispatch itself with anything other than Clang, as
the dispatch i/o portion cannot be built without compiler support for blocks.</p>

<h2>
<a id="runtime-requirements" class="anchor" href="#runtime-requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Runtime Requirements</h2>

<ul>
<li><a href="https://github.com/mheily/blocks-runtime">libBlocksRuntime</a></li>
<li><a href="https://github.com/mheily/libpwq">libpthread_workqueue</a></li>
<li><a href="https://github.com/mheily/libkqueue">libkqueue</a></li>
</ul>

<h2>
<a id="build-requirements" class="anchor" href="#build-requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build Requirements</h2>

<ul>
<li>
<a href="http://cmake.org">CMake</a> &gt;= 2.8.7</li>
<li>
<a href="http://python.org">Python2</a> &gt;= 2.6</li>
<li>
<a href="http://llvm.org">Clang</a> &gt;= 3.4</li>
</ul>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Started:</h2>

<p>On Ubuntu 12.04 LTS or greater, the required dependencies are available via
apt-get. (However it ships with Clang 3.0, which is rather old and is not
tested.)</p>

<pre><code>sudo apt-get install libblocksruntime-dev libkqueue-dev libpthread-workqueue-dev cmake

git clone git://github.com/nickhutchinson/libdispatch.git &amp;&amp; cd libdispatch
mkdir libdispatch-build &amp;&amp; cd libdispatch-build
../configure
make
sudo make install
</code></pre>

<p><a href="https://travis-ci.org/nickhutchinson/libdispatch"><img src="https://travis-ci.org/nickhutchinson/libdispatch.svg?branch=master" alt="Build Status"></a></p>

<h2>
<a id="known-issues" class="anchor" href="#known-issues" aria-hidden="true"><span class="octicon octicon-link"></span></a>Known Issues</h2>

<ul>
<li>2014-10-01 - Dispatch Sources of type <code>DISPATCH_SOURCE_TYPE_VNODE</code> are
unreliable, and should be avoided for now.</li>
</ul>

<h2>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing</h2>

<p>See the <code>run-tests.py</code> script in <code>testing/</code>.</p>

<h2>
<a id="demo" class="anchor" href="#demo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demo</h2>

<h3>
<a id="foreverc" class="anchor" href="#foreverc" aria-hidden="true"><span class="octicon octicon-link"></span></a>forever.c</h3>

<div class="highlight highlight-cpp"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>dispatch/dispatch.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdio.h<span class="pl-pds">&gt;</span></span>

<span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">timer_did_fire</span>(<span class="pl-k">void</span> *context) {
    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Strawberry fields...<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
}

<span class="pl-k">int</span> <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> *argv[]) {
    <span class="pl-c1">dispatch_source_t</span> timer = <span class="pl-c1">dispatch_source_create</span>(
        DISPATCH_SOURCE_TYPE_TIMER, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">dispatch_get_main_queue</span>());

    <span class="pl-c1">dispatch_source_set_event_handler_f</span>(timer, timer_did_fire);
    <span class="pl-c1">dispatch_source_set_timer</span>(timer, DISPATCH_TIME_NOW, <span class="pl-c1">1</span> * NSEC_PER_SEC,
                              <span class="pl-c1">0.5</span> * NSEC_PER_SEC);
    <span class="pl-c1">dispatch_resume</span>(timer);
    <span class="pl-c1">dispatch_main</span>();
}</pre></div>

<pre><code>&gt; clang forever.c -I/usr/local/include -L/usr/local/lib -ldispatch -o forever
&gt; ./forever

Strawberry fields...
Strawberry fields...
Strawberry fields...
Strawberry fields...
[...]
</code></pre>

<h2>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Credits</h2>

<p>This port was made possible by Mark Heily and others who contributed the
<code>libpthread_workqueue</code> and <code>libkqueue</code> libraries that libdispatch depends on, as
well as numerous portability patches floating around the official libdispatch
mailing list, notably <a href="http://lists.macosforge.org/pipermail/libdispatch-dev/2012-August/000676.html">http://lists.macosforge.org/pipermail/libdispatch-dev/2012-August/000676.html</a>.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/nickhutchinson/libdispatch/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/nickhutchinson/libdispatch/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/nickhutchinson/libdispatch"></a> is maintained by <a href="https://github.com/nickhutchinson">nickhutchinson</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-36058538-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
